# Аудит приложения: Mystic Tarot Oracle (Мистический Оракул)

Данный документ представляет собой подробный технический аудит архитектуры, кодовой базы и UI/UX составляющей приложения "Мистический Оракул".

## 1. Общий обзор архитектуры
Приложение представляет собой современное SPA (Single Page Application), построенное на стеке **React + Vite + TypeScript**. Для серверной части используется **Node.js (Express)**, выполняющий роль прокси-сервера для обхода ограничений CORS и деплоя на платформы вроде Render.

### Ключевой стек:
- **Frontend:** React 18, Tailwind CSS, Lucide-React (иконки).
- **AI Integration:** Google Gemini API (`@google/genai`).
- **Backend:** Express.js + `http-proxy-middleware`.
- **Markdown:** `react-markdown` для форматирования ответов оракула.

---

## 2. Сильные стороны (Strengths)

### 2.1. Логика работы с ИИ
- **Динамический выбор расклада:** Использование модели `gemini-3-flash-preview` для анализа вопроса пользователя и автоматического подбора наиболее подходящего расклада (из 9 доступных) — отличное решение для персонализации UX.
- **Failover (Отказоустойчивость):** В `geminiService.ts` реализован перебор API-ключей. Если один ключ исчерпал лимиты или недоступен в регионе, система пробует следующий. Это критически важно для бесплатных тиров Gemini.
- **Промпт-инжиниринг:** Системные инструкции задают глубокий мистический тон, что создает правильную атмосферу «сеанса».

### 2.2. Интерфейс и UX
- **Атмосфера:** Использование шрифтов Cinzel (сериф) и Lato (санс) в сочетании с цветовой схемой `Slate 950 / Amber 500` идеально попадает в тематику Таро.
- **Интерактивность:** 3D-анимация переворота карт (CSS `perspective` и `backface-hidden`) и пошаговое открытие карт вовлекают пользователя.
- **Секретные настройки:** Наличие скрытого меню (4 кликов в левый верхний угол) для отладки параметров модели и температуры — удобный инструмент для администратора.

### 2.3. Кодовая база
- **Типизация:** Использование TypeScript для описания карт, раскладов и состояний приложения минимизирует риск runtime-ошибок.
- **Модульность:** Четкое разделение на компоненты, сервисы и константы.

---

## 3. Выявленные риски и области для улучшения

### 3.1. Конфликты зависимостей (Критично, но пока не трогаем, чтобы сохранить работоспособность как в Google AI Studio так и на хостинге)
- В `index.html` используется **Import Map** (загрузка из esm.sh), в то время как в проекте есть `package.json` и `vite.config.ts`. При сборке через Vite это может привести к дублированию библиотек (React может загрузиться дважды: из npm и из CDN), что сломает состояние (Context/Hooks).
- **Рекомендация:** Следует придерживаться либо только Vite/npm, либо только Import Maps.

### 3.2. Работа с изображениями
- Пути к изображениям в `CardComponent.tsx` формируются динамически: `/cards/${folder}/${card.imageFileName}`. Если структура папок в `public` не совпадает идеально с `IMAGE_MAP` в `constants.ts`, карты не отобразятся.
- В аудите замечено, что некоторые файлы в `IMAGE_MAP` имеют специфические названия (например, `30_swords_two.jpg`), что может усложнить поддержку.

### 3.3. Безопасность
- Текущая архитектура передает API ключи через `process.env.API_KEY` или `VITE_API_KEYS`. При использовании `VITE_` префикса в Vite, ключи "вшиваются" в клиентский бандл и могут быть украдены.
- **Рекомендация:** Поскольку есть Express-сервер, запросы к Gemini лучше полностью перенести на бэкенд, чтобы ключи никогда не попадали в браузер.

### 3.4. UX нюансы
- **Отсутствие истории:** После нажатия "Задать иной вопрос" текущий расклад полностью стирается. Пользователь не может сохранить или скопировать результат, кроме как вручную.
- **Медленная анимация:** Для опытных пользователей 2-секундная анимация тасования и ожидание выбора расклада могут казаться затянутыми при повторном использовании.

---

## 4. Вердикт
Приложение высокого качества с глубокой проработкой логики Таро. Оно полностью готово к демонстрации, но требует синхронизации системы управления зависимостями (убрать Import Maps в пользу Vite) перед промышленным использованием.

**Оценка UI/UX:** 9/10
**Оценка архитектуры:** 7/10
**Стабильность AI:** 8/10 (благодаря системе ротации ключей)